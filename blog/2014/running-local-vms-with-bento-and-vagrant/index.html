<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    
    <!-- Website verification -->
    <meta name="google-site-verification" content="r_l7npAYPpfg7XREZHkXx3kPCug6F1CnQILCoPX4KOU" />

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Running local vm's with Packer, Bento and Vagrant | Andy Wenk</title>
    <meta name="author" content="Andy  Wenk" />
    <meta name="description" content="Running local vm's with Packer, Bento and Vagrant" />
    <meta name="keywords" content="andywenk, digitalblast, sumcumo, CTO" />

    <!-- Schema.org -->
    <script type="application/ld+json">
      {
        "author":
        {
          "@type": "Person",
          "name": "Andy  Wenk"
        },
        "url": "https://www.andy-wenk.de/blog/2014/running-local-vms-with-bento-and-vagrant/",
        "@type": "WebSite",
        "description": "Running local vm's with Packer, Bento and Vagrant",
        "headline": "Running local vm's with Packer, Bento and Vagrant",
        "sameAs": ["https://scholar.google.com/citations?user=dqdo9MgAAAAJ", "https://github.com/andywenk", "https://www.linkedin.com/in/andreas-wenk-88773a239", "https://www.digitalblast.com"],
        "name": "Andy  Wenk",
        "@context": "https://schema.org"
      }
    </script>


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/favicon.ico"/>
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://www.andy-wenk.de/blog/2014/running-local-vms-with-bento-and-vagrant/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark" />

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="https://www.andy-wenk.de/">Andy Wenk</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/activities/">Activities</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>

              <!-- Toogle theme mode -->
              <div class="toggle-container">
                <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </a>
              </div>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Running local vm's with Packer, Bento and Vagrant</h1>
    <p class="post-meta">April 19, 2014</p>
    <p class="post-tags">
      <a href="/blog/2014"> <i class="fas fa-calendar fa-sm"></i> 2014 </a>
        ·  
        <a href="/blog/tag/packer">
          <i class="fas fa-hashtag fa-sm"></i> packer</a>  
          <a href="/blog/tag/bento">
          <i class="fas fa-hashtag fa-sm"></i> bento</a>  
          <a href="/blog/tag/vagrant">
          <i class="fas fa-hashtag fa-sm"></i> vagrant</a>  
          
        ·  
        <a href="/blog/category/Server">
          <i class="fas fa-tag fa-sm"></i> Server</a>  
          

    </p>
  </header>

  <article class="post-content">
    <p>Inspired by <a href="https://twitter.com/rnewson" target="_blank" rel="noopener noreferrer">Bob Newson</a> while following the CouchDB <a href="freenode.net#couchdb-dev">dev IRC chat</a>, I gave <a href="http://www.packer.io/" target="_blank" rel="noopener noreferrer">Packer</a> and <a href="https://github.com/opscode/bento" target="_blank" rel="noopener noreferrer">Bento</a> a try. The idea is to build <a href="http://www.vagrantup.com/" target="_blank" rel="noopener noreferrer">Vagrant</a> boxes or use existing ones and start them locally for testing purposes. In this article I will show how to get a Centos 6.5 box running.</p>

<p>Packer is supporting many different <em>Builders</em> like VirtualBox, VMware, and Amazon EC2. We will use VirtualBox in this article. If you are not using it already, please <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener noreferrer">download</a> it. The usage is free of charge.</p>

<p>##Install Packer</p>

<p>This step is easy. The packer project is providing various <a href="http://www.packer.io/downloads.html" target="_blank" rel="noopener noreferrer">installer</a> for the most important platforms (Mac OS X, Linux, Windows, FreeBSD, OPenBSD). As we are using Mac OS X, we download and installed it. Easy!</p>

<p>##Clone the Bento repository</p>

<p>The Bento project is providing <em>Templates</em> for creating machine images. To be able to use these templates, the easiest way is to clone the Bento repository. Before that, we create a directory where all the vms will live.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~: mkdir vm &amp;&amp; cd vm
~/vm: git clone https://github.com/opscode/bento.git
</code></pre></div></div>

<p>The repository will be cloned into the directory <em>~/vm/bento</em>. Within the Bento repository, you will also find pre-built <em>Base-Boxes</em> you can download and use with Vagrant.</p>

<p><strong>side note:</strong> I really like, that the Packer project has defined and written down the <a href="http://www.packer.io/docs/basics/terminology.html" target="_blank" rel="noopener noreferrer">terminology</a> they are using. This helps a lot while speaking about Packer, because everybody is using the same wording. You should definitely read the page above.</p>

<p>##Building a box</p>

<p>Now it’s time to create our first box. The Packer API is very intuitive. For a deeper insight, you should read the <a href="http://www.packer.io/docs/" target="_blank" rel="noopener noreferrer">documentation</a>. The following steps will show, how to create a CentOS 6.5 box. We will then start the box with Vagrant later.</p>

<p>First, we create a target directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm: mkdir centos-6.5
</code></pre></div></div>

<p>Now we start creating the box. This will take a while so we should be patient:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm: cd bento/packer
~/vm/bento/packer: packer build -only=virtualbox-iso ../../centos-6.5/centos-6.5-x86_64.json
</code></pre></div></div>

<p>When the creation process is finished and no errors occured, we will find the created machine image in the following directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/bento/builds/virtualbox: opscode_centos-6.5_chef-provisionerless.box
</code></pre></div></div>

<p>In the final step, we will move the created image to our before created directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/bento/builds/virtualbox: mv opscode_centos-6.5_chef-provisionerless.box ~/vm/centos-6.5/
</code></pre></div></div>

<p>As already mentioned, we could have downloaded the image also from the bento repository page:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/bento/builds/virtualbox: cd ~/vm/centos-6.5
~/vm/centos-6.5: wget http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_centos-6.5_chef-provisionerless.box
</code></pre></div></div>

<p>##Installing Vagrant</p>

<p>We will need to install Vagrant to be able to run the image we created in the previous step. The Vagrant project is providing binary packages for Mac OS X, Windows, Debian, Ubuntu, CentOS, Redhat and Fedora. So let’s download the Mac OS X binary:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/centos-6.5: cd ~/Downloads
~/Downloads: wget https://dl.bintray.com/mitchellh/vagrant/vagrant_1.5.3.dmg
</code></pre></div></div>

<p>Then we install the package with the usual procedure on Mac OS X.</p>

<p>##Running the machine image with Vagrant</p>

<p>This is the final step where we create the machine image. Let’s first move again to the directory, where our <em>box</em> lives.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/Downloads: cd ~/vm/centos-6.5
</code></pre></div></div>

<p>Now we add our box to Vagrant. It is required to set a name and the path to our box. This is just one option out of three. Please refer to the <a href="https://docs.vagrantup.com/v2/cli/box.html" target="_blank" rel="noopener noreferrer">Vagrant documentation</a> to see the other options. This will also enable us to start the box by name later:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/centos-6.5: vagrant box add --name centos-6.5 opscode_centos-6.5_chef-provisionerless.box
==&gt; box: Adding box 'centos-6.5' (v0) for provider:
box: Downloading: file:///Users/andwen/vm/centos-6.5/opscode_freebsd-10.0_chef-provisionerless.box
==&gt; box: Successfully added box 'centos-6.5' (v0) for 'virtualbox'!
</code></pre></div></div>

<p>And now we have to initialize the box:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/centos-6.5: vagrant init centos-6.5 opscode_centos-6.5_chef-provisionerless.box
A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.
</code></pre></div></div>

<p>When we look at the directorys content, we see the created Vagrantfile. This file includes all the neccessary information to start the virtual machine. We do this by running the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/centos-6.5: vagrant up
vagrant up
Bringing machine 'default' up with 'virtualbox' provider...
==&gt; default: Importing base box 'centos-6.5'...
==&gt; default: Matching MAC address for NAT networking...
==&gt; default: Setting the name of the VM: centos-65_default_1397870052419_92480
==&gt; default: Fixed port collision for 22 =&gt; 2222. Now on port 2200.
==&gt; default: Clearing any previously set network interfaces...
==&gt; default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==&gt; default: Forwarding ports...
    default: 22 =&gt; 2200 (adapter 1)
==&gt; default: Booting VM...
==&gt; default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2200
    default: SSH username: vagrant
    default: SSH auth method: private key
    default: Warning: Connection timeout. Retrying...
==&gt; default: Machine booted and ready!
==&gt; default: Checking for guest additions in VM...
==&gt; default: Mounting shared folders...
    default: /vagrant =&gt; /Users/andwen/Documents/vm/centos-6.5
</code></pre></div></div>

<p>Now, the virtual machine has started. We can now connect to it via ssh. The user is <em>vagrant</em> and the password is <em>vagrant</em> as well. The ssh port was set to <em>2200</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/centos-6.5: ssh -p 2200 vagrant@127.0.0.1
The authenticity of host '[127.0.0.1]:2200 ([127.0.0.1]:2200)' can't be established.
RSA key fingerprint is 64:60:5d:ba:02:61:01:09:a4:9a:55:95:88:43:14:0a.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '[127.0.0.1]:2200' (RSA) to the list of known hosts.
vagrant@127.0.0.1's password:
Last login: Fri Apr 18 22:26:30 2014 from 10.0.2.2
[vagrant@localhost ~]$
</code></pre></div></div>

<p>Welcome to your first virtual machine setup with Packer, Bento and Vagrant.</p>

<p>##Removing the box</p>

<p>Because all the above is very easy, we will likely use this method to create virtual machines quite often. This will result in many machines and we will have the need to remove boxes. This is quite simple. First we will check which boxes exist:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/centos-6.5: vagrant box list
centos-6.5   (virtualbox, 0)
centos-6.5-2 (virtualbox, 0)
</code></pre></div></div>

<p>So let’s remove the box centos-6.5-2:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/vm/centos-6.5: vagrant box remove centos-6.5-2
Removing box 'centos-6.5-2' (v0) with provider 'virtualbox'...
</code></pre></div></div>

<p>##Summary</p>

<p>Packer, Bento and Vagrant are really great tools to set up virtual machines. In this article, we discussed how to do this based on VirtualBox. I start to use this to test CouchDB releases. There is still some work to do on the machine to get CouchBD installed, but it is definitely less time consuming compared to running various machines with the most important OS.</p>


  </article>

</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2022 Andy  Wenk. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme.
Last updated: September 25, 2022.
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script src="/assets/js/common.js"></script>

    

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0TB1250EC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-K0TB1250EC');
  </script>
  </body>
</html>
