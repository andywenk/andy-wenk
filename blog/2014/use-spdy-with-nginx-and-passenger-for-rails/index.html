<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    
    <!-- Website verification -->
    <meta name="google-site-verification" content="r_l7npAYPpfg7XREZHkXx3kPCug6F1CnQILCoPX4KOU" />

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Use SPDY with Nginx and Passenger for Rails | Andy Wenk</title>
    <meta name="author" content="Andy  Wenk" />
    <meta name="description" content="Use SPDY with Nginx and Passenger for Rails" />
    <meta name="keywords" content="andywenk, digitalblast, sumcumo, CTO" />

    <!-- Schema.org -->
    <script type="application/ld+json">
      {
        "author":
        {
          "@type": "Person",
          "name": "Andy  Wenk"
        },
        "url": "https://www.andy-wenk.de/blog/2014/use-spdy-with-nginx-and-passenger-for-rails/",
        "@type": "WebSite",
        "description": "Use SPDY with Nginx and Passenger for Rails",
        "headline": "Use SPDY with Nginx and Passenger for Rails",
        "sameAs": ["https://scholar.google.com/citations?user=dqdo9MgAAAAJ", "https://github.com/andywenk", "https://www.linkedin.com/in/andreas-wenk-88773a239", "https://www.digitalblast.com"],
        "name": "Andy  Wenk",
        "@context": "https://schema.org"
      }
    </script>


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/favicon.ico"/>
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://www.andy-wenk.de/blog/2014/use-spdy-with-nginx-and-passenger-for-rails/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark" />

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="https://www.andy-wenk.de/">Andy Wenk</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/activities/">Activities</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>

              <!-- Toogle theme mode -->
              <div class="toggle-container">
                <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </a>
              </div>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Use SPDY with Nginx and Passenger for Rails</h1>
    <p class="post-meta">April 10, 2014</p>
    <p class="post-tags">
      <a href="/blog/2014"> <i class="fas fa-calendar fa-sm"></i> 2014 </a>
        ·  
        <a href="/blog/tag/nginx">
          <i class="fas fa-hashtag fa-sm"></i> nginx</a>  
          <a href="/blog/tag/rails">
          <i class="fas fa-hashtag fa-sm"></i> rails</a>  
          
        ·  
        <a href="/blog/category/Server">
          <i class="fas fa-tag fa-sm"></i> Server</a>  
          

    </p>
  </header>

  <article class="post-content">
    <p>I am using <a href="https://www.phusionpassenger.com/" target="_blank" rel="noopener noreferrer">Passenger</a> with <a href="http://nginx.org/" target="_blank" rel="noopener noreferrer">Nginx</a> to serve Rails applications. Although I was thinking about moving to <a href="http://puma.io/" target="_blank" rel="noopener noreferrer">Puma</a> because of some technical reasons, I still think that Passenger is a solid, prooved and good webserver for Rails applications.</p>

<p>As you already know, we are waiting for <a href="http://http2.github.io/" target="_blank" rel="noopener noreferrer">HTTP/2</a> and <a href="http://en.wikipedia.org/wiki/SPDY" target="_blank" rel="noopener noreferrer">SPDY</a>. SPDY is basically the same as HTTP but does always include TLS encryption and is able to use multiplexing (plus other cool features). This means parallel transfer of assets because only one connection per client is required. Woot!</p>

<p>Passenger does not include SPDY from scratch but Phusion is providing a patched binary you can integrate. As of this writing, the binary does support SPDY/2. Here is a list how to integrate the binary. I assume you have compiled Nginx with Passenger. Please do read first the whole list and start the work afterwards.</p>

<p>##1. Follow the guide</p>

<p>Hongli Lai (<a href="https:/twitter.com/honglilai" target="_blank" rel="noopener noreferrer">@honglilai</a>) has written a guide, how to use Nginx and SPDY. Read the steps here: <a href="http://blog.phusion.nl/2013/08/21/use-nginx-spdy-without-compiling-nginx-and-without-a-recent-openssl/" target="_blank" rel="noopener noreferrer">Use Nginx + SPDY, without compiling Nginx and without a recent OpenSSL</a> but do not start immediately.</p>

<p>I am not sure why the title has “without a recent OpenSSL” because you will see later, that the tests for the Heartbleed bug do pass.</p>

<p>##2. Follow these steps</p>

<p>We do have a working Nginx installation already, so there is no need to install Nginx (as stated in the guide). What we need is the patched binary and replace the existing one. I have asked Hongli in the comments below the post about why there is no nginx tar anymore. It is just renamed. Hongli has upgraded the blog post thankfully. Here is what you need to do:</p>

<h4 id="a-add-the-deb-source-from-phusion-to-your-sourceslist">a. Add the deb source from Phusion to your sources.list.</h4>

<p>On Ubuntu, simply add a file in the <em>sources.list.d</em> directory</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch /etc/apt/sources.list.d/passenger.list
</code></pre></div></div>

<p>and add this content:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deb https://oss-binaries.phusionpassenger.com/apt/passenger precise main
</code></pre></div></div>

<p>####b. Upgrade your system</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get upgrade
</code></pre></div></div>

<p>You MAY receive ERRORS. Don’t worry and keep on going.</p>

<p>####c. Download the binary</p>

<p>As of this writing it is the source below. It may be different when you read this post. You can simply check <a href="https://oss-binaries.phusionpassenger.com/binaries/passenger/by_release" target="_blank" rel="noopener noreferrer">https://oss-binaries.phusionpassenger.com/binaries/passenger/by_release</a>. It is VERY important, that the binaries version is the exact same version as of your Nginx installation.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -O https://oss-binaries.phusionpassenger.com/binaries/passenger/by_release/4.0.41/webhelper-1.4.7-x86_64-linux.tar.gz
curl -O https://oss-binaries.phusionpassenger.com/binaries/passenger/by_release/4.0.41/webhelper-1.4.7-x86_64-linux.tar.gz.asc
</code></pre></div></div>

<p>####d. Get the developers gpg key and verify the tar archive</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpg --recv-keys AC40B2F7
gpg --verify  webhelper-1.4.7-x86_64-linux.tar.gz.asc
</code></pre></div></div>

<p>No errors should show up.</p>

<p>####e. Extract the archive and rename the binary to nginx</p>

<p>As written in the guide by Hongli, Phusion renamed the binary to PassengerWebHelper. Simply rename it to <em>nginx</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar xzvf webhelper-1.4.7-x86_64-linux.tar.gz
mv PassengerWebHelper nginx
</code></pre></div></div>

<p>####f. Copy the binary to the correct place. It may be different in your system depending on where you have installed Nginx</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo cp /usr/sbin/nginx nginx.original
sudo /etc/init.d/nginx stop
sudo cp nginx /usr/sbin/
</code></pre></div></div>

<p>####g. Update your Nginx vhost configuration.</p>

<p>For the regarding SSL domain, yop need to add the keyword <em>spdy</em> to the <em>listen</em> directive:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listen 443 default_server ssl spdy deferred;
</code></pre></div></div>

<p>####h. Restart nginx</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /etc/init.d/nginx restart
</code></pre></div></div>

<p>####i. Check if SPDY is activated</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://spdycheck.org/#www.YOUR_DOMAIN.com
</code></pre></div></div>

<p>####j. Check that the doamin is not vulnerable agints the Heartbleed bug</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://filippo.io/Heartbleed/#www.YOUR_DOMAIN.com
</code></pre></div></div>

<p>If everything works, you should now have SPDY support for your Rails application. Go and check out the parallel transfer of the sources in your browsers developer toolbar and enjoy :-)</p>


  </article>

</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2022 Andy  Wenk. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme.
Last updated: September 25, 2022.
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script src="/assets/js/common.js"></script>

    

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0TB1250EC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-K0TB1250EC');
  </script>
  </body>
</html>
